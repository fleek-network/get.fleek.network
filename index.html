#!/bin/bash

# <!-- IGNORE: This line is intentional DO NOT MODIFY --><pre><script>document.querySelector('body').firstChild.textContent = '#!/bin/bash'</script>

# "Get Fleek Network" is an attempt to make our software more accessible.
# By providing scripts to automate the installation process of our software,
# we believe that it can help improve the onboarding experience of our users.
#
# Quick install: `curl https://get.fleek.network | bash`
#
# This script automates the process illustrated in our guide "Running a Node in a Docker container"
# and "how to install rust and the dependencies for ursa cli"
# advanced users might find it better to follow the instructions in the guide
# If that's your preference, go ahead and check our guides https://docs.fleek.network
#
# Contributing?
# - If you'd like to test changes locally use the env var `USE_BRANCH_NAME_FOR_GH_RAW`, for remote locales pulls
#
# Found an issue? Please report it here: https://github.com/fleek-network/get.fleek.network

# Default to branch "main"
useBranch=${USE_BRANCH_NAME_FOR_GH_RAW="main"}

# Workdir
if ! cd "$(mktemp -d)"; then
  echo "ðŸ‘¹ Oops! We tried to create a temporary directory to host some install artifacts but failed for some reason..."

  exit 1
fi

# The white space before and after is intentional
cat << "ART"

  â­ï¸ Ursa, a Decentralized Content Delivery Network (DCDN) â­ï¸

       ,-.
      / \  `.   __..-,O
     :   \  --''_..-'.'
     |    . .-' `. '.
     :     .     .`.'
      \     `.  /  ..
       \      `.   ' .
        `,       `.   \
        ,|,`.        `-.\
       '.||  ``-...__..-`
        |  |
        |__|
        /||\
       //||\\
      // || \\
   __//__||__\\__
  '--------------' URSA

ART

echo
echo "ðŸ‘½ Welcome ultra-terrestrial being ðŸ‘½"
echo
echo "We are ready to launch the communication channel with the Fleek Network ðŸ“¡, but you need to make a choice!"
echo "There are two options, where option number 1 is to run a Network Node un a Docker Container, or option number 2, installed natively in your operating system."
echo "Most Node Operators are using the Docker Stack (if you stick with the recommendations, this is the quickest way to setup ðŸš€), while other's have a preference for running Natively (might take longer to set up, as it requires building the Ursa CLI binary from the Rust ðŸ¦€ source-code)."
echo
echo "Select how to run the Fleek Network:"
echo
echo "1) ðŸ”« Docker Stack (recommended)"
echo "2) ðŸ‘¾ Natively"
echo

(
  exec < /dev/tty;
  
  while read -rp "Type your selection number> " answer; do
    if [[ $answer -eq 1 ]]; then
      echo
      read -rp "ðŸ§‘â€ðŸš€ Nice choice terrestrial! We'll launch the process, press ENTER to continue..."

      curl -s "https://raw.githubusercontent.com/fleek-network/get.fleek.network/$useBranch/scripts/install_docker" > install_docker
      chmod +x install_docker

      ./install_docker

      break
    elif [[ $answer -eq 2 ]]; then
      echo
      echo "ðŸ”­ Nice one astrophysicist! Before we launch the process, just to let you know that the Ursa CLI (used to start the Node Network) will be compiled from the Rust ðŸ¦€ source code. Depending on your spaceship specifications this can be quite slow, be patient!"
      echo
      read -rp "Let's launch the process, press ENTER to continue..."

      curl -s "https://raw.githubusercontent.com/fleek-network/get.fleek.network/$useBranch/scripts/install_native" > install_native
      chmod +x install_native

      ./install_native

      break;
    fi

    echo "ðŸ’© Uh oh! We're expecting a yes (Y) or a no (N) answer. Try again..."
  done
)