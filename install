#!/bin/bash

# <!-- IGNORE: This line is intentional DO NOT MODIFY --><pre><script>document.querySelector('body').firstChild.textContent = '#!/bin/bash'</script>

# "Get Fleek Network" is an attempt to make our software more accessible.
# By providing scripts to automate the installation process of our software,
# we believe that it can help improve the onboarding experience of our users.
#
# Quick install: `curl https://get.fleek.network | bash`
#
# This script automates the process illustrated in our "Getting started" guides
# advanced users might find it better to follow the instructions in the doc version
# If that's your preference, go ahead and check our guides https://docs.fleek.network
#
# Contributing?
# - If you'd like to test changes locally use the env var `USE_BRANCH_NAME_FOR_GH_RAW`, for remote locales pulls
#
# Found an issue? Please report it here: https://github.com/fleek-network/get.fleek.network

# Default to branch "main"
useBranch=${USE_BRANCH_NAME_FOR_GH_RAW="main"}

# Workdir
if ! cd "$(mktemp -d)"; then
  echo "ğŸ‘¹ Oops! We tried to create a temporary directory to host some install artifacts but failed for some reason..."

  exit 1
fi

# The white space before and after is intentional
cat << "ART"

  â­ï¸ Fleek Network Lightning CLI â­ï¸

                  .eeeeeeeee
                  .$$$$$$$$P"
                .$$$$$$$$P
                z$$$$$$$$P
              z$$$$$$$$"
              z$$$$$$$$"
            d$$$$$$$$"
            d$$$$$$$$"
          .d$$$$$$$P
        .$$$$$$$$P
        .$$$$$$$$$.........
      .$$$$$$$$$$$$$$$$$$"
      z$$$$$$$$$$$$$$$$$P"
    -**********$$$$$$$P
              d$$$$$$"
            .d$$$$$$"
            .$$$$$$P"
          z$$$$$$P
          d$$$$$$"
        .d$$$$$$"
      .$$$$$$$"
      z$$$$$$$beeeeee
    d$$$$$$$$$$$$$*
    ^""""""""$$$$$"
            d$$$*
          d$$$"
          d$$*
        d$P"
      .$$"
      .$P"
    .$"
    .P"
  ."
  /"

ART

echo
echo "â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… ğŸŒ Website https://fleek.network"
echo "â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… ğŸ“š Documentation https://docs.fleek.network"
echo "â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… ğŸ’¾ Git repository https://github.com/fleek-network/lightning"
echo "â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… ğŸ¤– Discord https://discord.gg/fleekxyz"
echo "â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… ğŸ¤ Twitter https://twitter.com/fleek_net"
echo "â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜… ğŸ¨ Ascii art by https://www.asciiart.eu"
echo

(
  exec < /dev/tty;

  # ğŸš‘ Check if running in Bash and supported version
  [ "$BASH" ] || { printf >&2 'ğŸ™ Run the script with Bash, please!\n'; exit 1; }
  (( BASH_VERSINFO[0] > 4 || BASH_VERSINFO[0] == 4 && BASH_VERSINFO[1] >= 2 )) || { printf >&2 'ğŸ™ Bash 4.2 or newer is required!\n'; exit 1; }

  # ğŸš‘ Check total Processing Units
  defaultMinCPUUnitsCount=2
  vCPUs=$(nproc --all)
  if [[ "$vCPUs" -lt "$defaultMinCPUUnitsCount" ]]; then
    while read -rp "ğŸ˜… The installer needs at least $defaultMinCPUUnitsCount total processing units, your system has $vCPUs. The installer is likely to fail, would you like to continue? (yes/no)" answer; do
      if [[ "$answer" == [nN] || "$answer" == [nN][oO] ]]; then
        printf "ğŸ¦– Exited the installation process\n\n"

        exit 1
      elif [[ "$answer" == [yY] || "$answer" == [yY][eE][sS] ]]; then
        printf "ğŸ˜… Good luck!\n\n"

        break;
      fi

      printf "ğŸ’© Uh-oh! We expect a yes or no answer. Try again...\n"
    done
  fi
  
  # TODO: Native install process
)